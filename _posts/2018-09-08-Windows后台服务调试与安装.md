## Windows后台服务调试与安装

<!-- more -->

在我们日常工作中，不免需要编写windows后台服务程序。在这过程中，你是否有考虑过这几个问题呢？
- 服务调试很麻烦？
- 双击不能启动服务？
- 如何安装服务？
- 如何使用管理员权限启动？

针对以上问题，今天我们就来聊聊它们！

>### **调试服务**

在调试服务前，我们肯定需要先新建一个服务的解决方案。打开 Visual Studio ，“新建项目” -> “Windows 服务” 点击确定。如下图所示：

![](https://i.loli.net/2018/09/08/5b935455cbd5c.jpg)

新建windows服务工程后，我们就可以在service1.cs文件里面添加我们的逻辑代码（跟普通写程序一样，这里就不做赘述）。
我们可以尝试随便写一些逻辑代码，并准备开始调试。
调试的方式有几种：

1. 通过附加进程和断点调试

    因为服务一般情况下是不能通过双击启动的，必须得先把服务安装好后才能调试<br/>
    这个时候，OnStart方法在执行的时候，我们没有办法去调试我们的代码，整个调试过程会变得很困难。
    这个时候，我们可能会考虑采用第二种方案（即下面的这种方案）。
   
1. 通过Debugger.Launch()

    在这种方案下，我们只需要插入 ``` Debugger.Launch() ``` 代码到期望中断的位置，服务在启动的时候，便会把启动调试器的窗口弹出来，我们选择一个调试器就可以进去调试了。
    如下图所示：
    <br/>

    ![](https://i.loli.net/2018/09/08/5b9358a9ae084.jpg)

     <br/>
    随后的调试方法跟普通调试一样。不过这种方式也存在比较明显的缺点：每次调试一次都会弹出 打开调试器窗口 ，费时费力，体检较差。
    <br/>接下来看看第三种方法。    

1. 通过直接启动方式调试

    在种模式下，我们首先需要了解一点，程序即时控制台，服务也不例外。在使用这种模式之前，我们首先需要将我们之前添加的服务程序设置成控制台程序。

>### **安装服务**

>### **提升权限**